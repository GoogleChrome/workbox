# sw-background-sync-queue

A service worker implementation of the a queue which is triggered by the background sync event.

## Installation

`npm install --save-dev sw-background-sync-queue`

## Demo

Browse sample source code in the [demo directory](https://github.com/GoogleChrome/sw-helpers/tree/master/docs/demos/sw-background-sync-queue/), or
[try it out](https://googlechrome.github.io/sw-helpers/demos/sw-background-sync-queue/) directly.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### sw-background-sync-queue

[packages/sw-background-sync-queue/src/index.js:20-20](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/index.js#L20-L20 "Source code on GitHub")

sw-background-sync-queue Module

### initialize

[packages/sw-background-sync-queue/src/index.js:32-42](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/index.js#L32-L42 "Source code on GitHub")

Initialize the library by initializing broadcast manager,
indexedDB, and request manager

**Parameters**

-   `broadcastChannel` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** 
-   `dbName` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** 
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.broadcastChannel`  
    -   `$0.dbName`  

### getQueueableRequest

[packages/sw-background-sync-queue/src/lib/queue-utils.js:15-34](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/queue-utils.js#L15-L34 "Source code on GitHub")

takes a request and gives back JSON object that is storable in IDB

**Parameters**

-   `request` **[Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request)** request object to transform
    into iDB storable object
-   `config` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** config object to be
    stored along in the iDB
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.request`  
    -   `$0.config`  

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** indexable object for iDB

### cleanupQueue

[packages/sw-background-sync-queue/src/lib/queue-utils.js:55-82](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/queue-utils.js#L55-L82 "Source code on GitHub")

clean up the queue, deleting all the tasks who are either damaged or
whose maxAge has expired

### RequestManager

[packages/sw-background-sync-queue/src/lib/request-manager.js:13-88](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-manager.js#L13-L88 "Source code on GitHub")

Class to handle all the request related
transformations, replaying, event handling
broadcasting back to controlled pages etc.

#### constructor

[packages/sw-background-sync-queue/src/lib/request-manager.js:22-28](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-manager.js#L22-L28 "Source code on GitHub")

Initializes the request manager
stores the callbacks object, maintains config and
attaches event handler

**Parameters**

-   `any`  {callbacks, queue}
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.callbacks`  
    -   `$0.queue`  

#### attachSyncHandler

[packages/sw-background-sync-queue/src/lib/request-manager.js:36-42](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-manager.js#L36-L42 "Source code on GitHub")

attaches sync handler to replay requests when
sync event is fired

#### replayRequests

[packages/sw-background-sync-queue/src/lib/request-manager.js:51-87](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-manager.js#L51-L87 "Source code on GitHub")

function to start playing requests
in sequence

Returns **void** 

### RequestQueue

[packages/sw-background-sync-queue/src/lib/request-queue.js:19-130](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-queue.js#L19-L130 "Source code on GitHub")

Core queue class that handles all the enqueue and dequeue
as well as cleanup code for the background sync queue

#### constructor

[packages/sw-background-sync-queue/src/lib/request-queue.js:25-36](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-queue.js#L25-L36 "Source code on GitHub")

Creates an instance of Queue.

**Parameters**

-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.config`  
    -   `$0.queueName`   (optional, default ` allQueues || [];
        			if(!allQueues.inclu`)
    -   `$0.idbQDb`  

#### push

[packages/sw-background-sync-queue/src/lib/request-queue.js:68-101](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-queue.js#L68-L101 "Source code on GitHub")

push any request to background sync queue which would be played later
preferably when network comes back

**Parameters**

-   `request` **[Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request)** request object to be queued by this
-   `config` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** optional config to override config params
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.request`  

#### getRequestFromQueue

[packages/sw-background-sync-queue/src/lib/request-queue.js:111-117](https://github.com/GoogleChrome/sw-helpers/blob/8cc4a6ad43a96e15ede74e8b1864c9185cfac260/packages/sw-background-sync-queue/src/lib/request-queue.js#L111-L117 "Source code on GitHub")

get the Request from the queue at a particular index

**Parameters**

-   `hash` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** hash of the request at the given index
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.hash`  

Returns **[Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request)** 
